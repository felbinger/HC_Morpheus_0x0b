<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Itrago</title>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.bundle.min.js" integrity="sha384-feJI7QwhOS+hwpX2zkaeJQjeiwlhOP+SdQDqhgvvo1DsjtiSQByFdThsxO669S2D" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
    function request(type,url,data,callback){var xhr;if(window.XMLHttpRequest){xhr=new XMLHttpRequest}else{xhr=new ActiveXObject("Microsoft.XMLHTTP")}xhr.open(type,url,true);xhr.setRequestHeader("Content-type","application/json; charset=utf-8");xhr.onload=function(){callback(xhr.response)};xhr.send(data)}
    function login(username, password) {
      request("POST", window.location.protocol + "//" + window.location.host + "/" + "login", JSON.stringify({'username': username, 'password': btoa(password)}), function (response) {
        response = JSON.parse(response)
        if (!response.hasOwnProperty("error")) {
          $("#login_msg").html('<div class="form-group"><div class="alert alert-success">' + response["msg"] + '</div></div>')
        } else {
          $("#login_msg").html('<div class="form-group"><div class="alert alert-danger"><span class="fa fa-info-circle"></span>' + ((response["error"] === "wrong credentials") ? " Wrong Credentials" : "Internal Error") + '</div></div>');
        }
        $("#username").val();
        $("#password").val();
      });
    }
    </script>
  </head>
  <body>
    <style>
			@charset "utf-8";

			*{
				margin:0;
				padding:0;
			}
			#login-form {
				margin:5% auto;
				max-width:500px;
			}
		</style>
    <div class="container">
      <div id="login-form">
        <div class="col-md-12">
          <div class="form-group">
            <h2 align="center">Login</h2>
          </div>
          <div class="form-group">
            <hr/>
          </div>
          <div id="login_msg"></div>
          <div class="form-group">
            <div class="input-group">
              <input type="text" id="username" class="form-control" placeholder="Username" maxlength="120" required/>
            </div>
          </div>
          <div class="form-group">
            <div class="input-group">
              <input type="password" id="password" class="form-control" placeholder="Password" maxlength="120" required/>
            </div>
          </div>
          <div class="form-group">
            <hr />
          </div>
          <div class="form-group">
            <button class="btn btn-block btn-primary" onclick="login($('#username').val(), $('#password').val())">Login</button>
          </div>
          <a data-toggle="modal" href="#passwordReset">Reset password</a>
        </div>
      </div>
    </div>

    <!-- Modal: Itrago Password Reset -->
    <div class="modal fade" id="passwordReset">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Itrago Password Reset Instructions</h4>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          </div>
          <div style="margin-left:10px" class="modal-body">
            <ol>
              <li>Access the Itrago Emergency Shell</li>
              <li>Authenticate yourself</li>
              <li><a href="https://www.w3schools.com/sql/">Change</a> your password</li>
            </ol>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script>
  /*
  // TODO in development
  function getInfo() {
    request("POST", host + "getInfo", "", function (response) {});
  }
  */
  </script>
</html>
